{% extends "layout.jinja2" %}

{% block content %}

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-10">
      <h2>Summary</h2>
      <p>The <i>literature</i> section presents previous knowledge about this protein. There have been five different efforts to annotate minimal organism genome. The annotations from those efforts are given in the <i>Literature</i> section for completeness.</p>
    </div>
    <div class="col-10 mb-1">
    <div class="card-group">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">{{ res[0][0] }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ res[0][1] }}</h6>
          <p class="card-text">{{ res[0][3] }}. <br> <em>M. mycoides</em> homolog: {{ res[0][2] }}.<br>  TIGRfam Classification: {{ res[0][4] }}.<br>  Category: {{ res[0][5] }}.</p>
        </div>
      </div>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Statistics</h5>
          <p class="card-text">Total GO Annotation: {{ res[0][6] }} <br> Unique PROST Go: {{ res[0][7] }} <br> Unique BLAST Go: {{ res[0][8] }} <br> Unique Foldseek Go: {{ res[0][9] }}</p>
          <p class="card-text">Total Homologs: {{ res[0][10] }} <br> Unique PROST Homologs: {{ res[0][11] }} <br> Unique BLAST Homologs: {{ res[0][12] }} <br> Unique Foldseek Homologs: {{ res[0][13] }}</p>
        </div>
      </div>
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Literature</h5>
          <p class="card-text">Danchin and Fang <a href="https://doi.org/10.1111/1751-7915.12384" target="_blank">[1]</a>: {{ res[0][14] }} <br>
                               Yang and Tsui <a href="https://pubs.acs.org/doi/10.1021/acs.jproteome.8b00262" target="_blank">[2]</a>: {{ res[0][15] }} <br>
                               Antczak et al. <a href="https://doi.org/10.1038/s41467-019-10837-2" target="_blank">[3]</a>: {{ res[0][16] }} <br>
                               Zhang et al. <a href="https://pubs.acs.org/doi/10.1021/acs.jproteome.0c00359?ref=pdf" target="_blank">[4]</a>: {{ res[0][17] }} <br>
                               Bianchi et al. <a href="https://pubs.acs.org/doi/full/10.1021/acs.jpcb.2c04188" target="_blank">[5]</a>: {{ res[0][18] }}</p>
        </div>
      </div>
    </div>
    </div>
    <div class="col-10">
      <h2>Structures and Sequence Alignment</h2>
      <p>The best structural homolog that predicted by {{ res[1][4] }} was
         <a href="https://www.uniprot.org/uniprot/{{ res[1][0] }}" target="_blank">{{ res[1][0] }}</a>
         ({{ res[1][3] }}) with a FATCAT <b>P-Value: {{ res[1][1] }}</b> and RMSD of <b>{{res[1][5] }} angstrom</b>.  The sequence alignment identity is <b>{{ res[1][2] }}</b>.<br>
        Structural alignment shown in left. Query protein {{ res[0][0] }} colored as red in alignment, homolog {{ res[1][0] }} colored as blue.
        Query protein {{ res[0][0] }} is also shown in right top, homolog {{ res[1][0] }} showed in right bottom. They are colored based on secondary structures. </p>
    </div>
    <div class="col-5">
      <div id="viewport1" class='border' style="height:400px;"></div>
    </div>
    <div class="col-5">
      <div id="viewport2" class='border' style="height:200px;"></div>
      <div id="viewport3" class='border' style="height:200px;"></div>
    </div>
    <div class="col-10 d-flex justify-content-center mb-1 mt-1">
        {{ res[5] }}
    </div>
    <div class="col-10">
      <h2>Go Annotations</h2>
      <p><b>1. PBF</b> indicates the go terms that are found by both PROST and BLAST and Foldseek.<br>
         <b>2. PF</b> indicates the go terms that are found by only PROST and Foldseek.<br>
         <b>3. BF</b> indicates the go terms that are found by only BLAST and Foldseek.<br>
         <b>4. PB</b> indicates the go terms that are found by both PROST and BLAST.<br>
         <b>5. P</b> indicates the go terms that are found by only PROST.<br>
         <b>6. F</b> indicates the go terms that are found by only Foldseek.<br>
         <b>7. B</b> indicates the go terms that are found by only BLAST.</p>
    </div>
    <div class="col-10 mb-5">
    <table id="goTable" class="table table-striped tDisplay " style="width:100%">
        <thead>
            <tr>
                <th>Source</th>
                <th>GO</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
          {% for g in res[2] %}
            <tr>
                <td>{{ g[0] }}</td>
                <td><a href="http://amigo.geneontology.org/amigo/term/{{ g[1] }}" target="_blank">{{ g[1] }}</a></td>
                <td>{{ g[2] }}</td>
            </tr>
          {% endfor %}
        </tbody>
    </table>
    </div>
    <div class="col-10">
      <h2>Uniprot GO Annotations</h2>
    </div>
    <div class="col-10 mb-5">
    <table id="goTable2" class="table table-striped tDisplay " style="width:100%">
        <thead>
            <tr>
                <th>GO</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
          {% for g in res[3] %}
            <tr>
                <td><a href="http://amigo.geneontology.org/amigo/term/{{ g[0] }}" target="_blank">{{ g[0] }}</a></td>
                <td>{{ g[1] }}</td>
            </tr>
          {% endfor %}
        </tbody>
    </table>
    </div>
    <div class="col-10">
      <h2>Homologs</h2>
      <p><b>1. PBF</b> indicates the homologs that are found by both PROST and BLAST and Foldseek.<br>
         <b>2. PF</b> indicates the homologs that are found by only PROST and Foldseek.<br>
         <b>3. BF</b> indicates the homologs that are found by only BLAST and Foldseek.<br>
         <b>4. PB</b> indicates the homologs that are found by both PROST and BLAST.<br>
         <b>5. P</b> indicates the homologs that are found by only PROST.<br>
         <b>6. F</b> indicates the homologs that are found by only Foldseek.<br>
         <b>7. B</b> indicates the homologs that are found by only BLAST.</p>
    </div>
    <div class="col-10 mb-5">
    <table id="homTable" class="table table-striped tDisplay" style="width:100%">
        <thead>
            <tr>
                <th>Source</th>
                <th>Homolog</th>
                <th>Description</th>
                <th>Fatcat Pvalue</th>
                <th>PROST Evalue</th>
                <th>BLAST Evalue</th>
                <th>Foldseek TMScore</th>
            </tr>
        </thead>
        <tbody>
          {% for h in res[4] %}
            <tr>
                <td>{{ h[0] }}</td>
                <td><a href="https://www.uniprot.org/uniprot/{{ h[1] }}" target="_blank">{{ h[1] }}</a></td>
                <td>{{ h[2] }}</td>
                <td>{{ h[3] }}</td>
                <td>{{ h[4] }}</td>
                <td>{{ h[5] }}</td>
                <td>{{ h[6] }}</td>
            </tr>
          {% endfor %}
        </tbody>
    </table>
    </div>
  </div>
</div>

<script>
  $(document).ready(function () {
      $('#homTable').DataTable( {
            "columnDefs": [
                { "type": "scientific", targets: 3 },
                { "type": "scientific", targets: 4 },
                { "type": "scientific", targets: 5 }
            ]
        } );
      $('#goTable').DataTable();
      $('#goTable2').DataTable();
  });
  var stage;
  document.addEventListener("DOMContentLoaded", function () {
    stage1 = new NGL.Stage("viewport1", { backgroundColor: "white" });
    stage1.loadFile("/static/results/{{ pid }}/aln.pdb").then(function (o) {
      o.addRepresentation("cartoon", {colorScheme: "chainindex", smoothSheet: true});
      o.autoView();
    });
    stage2 = new NGL.Stage("viewport2", { backgroundColor: "white" });
    stage2.loadFile("/static/results/{{ pid }}/query.pdb").then(function (o) {
      o.addRepresentation("cartoon", {colorScheme: "sstruc", smoothSheet: true});
      o.autoView();
    });
    stage3 = new NGL.Stage("viewport3", { backgroundColor: "white" });
    stage3.loadFile("/static/results/{{ pid }}/target.pdb").then(function (o) {
      o.addRepresentation("cartoon", {colorScheme: "sstruc", smoothSheet: true});
      o.autoView();
    });
  });
</script>
{% endblock %}
